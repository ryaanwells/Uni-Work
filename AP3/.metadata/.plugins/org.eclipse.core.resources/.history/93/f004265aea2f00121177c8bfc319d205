import java.io.File;
import java.util.concurrent.ConcurrentSkipListSet;
import java.util.concurrent.LinkedBlockingQueue;
import java.util.regex.Matcher;
import java.util.regex.Pattern;


public class HarvestThread implements Runnable{

	private String name;
	private ConcurrentSkipListSet<String> CSL;
	private LinkedBlockingQueue<String> LBQ;
	private Pattern p;
	
	public HarvestThread(int i,LinkedBlockingQueue<String> L, 
			ConcurrentSkipListSet<String> C, Pattern p){
		name = "Harvest " + i;
		CSL = C;
		LBQ = L;
	}
	
	public void run(){
		while(true){
			try{
				String fn;
				System.out.println("waited");
				fn = LBQ.take();
				
				File file = new File(fn);
				File[] contents = file.listFiles();
				if(contents != null)
					for(File f: contents){
						String fileName = f.getName();
						Matcher m = p.matcher(fileName);
						if (m.matches()){
							CSL.add(fileName);
						}
					}
				}
			} catch(InterruptedException e){return;}
		}
	}
	
}
